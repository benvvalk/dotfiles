#!/bin/bash
set -eu -o pipefail

if [ $# -ne 1 ]; then
    echo "Usage: $(basename $0) PNG_FILENAME" >&2
    exit 1
fi

png="$1"

# Note: We first write to a temp file under C:\tmp and then copy
# that file to our desired output path ($png) because the
# MiniCap.exe utility can only write to a Windows path.

tmpdir='/mnt/c/tmp'
mkdir -p "$tmpdir"

tmpfile=$(mktemp -p "$tmpdir" cliprect.XXXXXX.png)

MiniCap.exe -exit -escapequit -save $(winpath "$tmpfile") -captureregselect -bordershadow

cp "$tmpfile" "$png"
